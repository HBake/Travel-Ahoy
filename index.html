<html>

    <head>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
        
        
        <title>Travel Ahoy!</title>
        <script src='https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js'></script>
        <link href='https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css' rel='stylesheet' />

        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script> 

        <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
        <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
        <script>

            


        </script>
        <style>
            body {
                background-image: url("https://imgur.com/2e5DqO2.png");
                background-repeat: no-repeat;
                background-attachment: fixed;
                background-position: center;
                background-size: cover;
                font-size: 110%;
            }
            a:link {
                text-decoration: none;
                color: rgb(255, 255, 255);
            }
            a:visited{
                text-decoration: none;
                color: rgb(255,255,255);
            }
            a:hover {
                text-decoration:none;
                color: rgb(255, 255, 255);
            }
            a:active {
                color: rgb(255, 255, 255);
                text-decoration: none;
            }

            :root {
                --select: false;
            }
            .loader {
                position: fixed;
                top: 30%;
                left: 50%;
                margin-top: -60px;
                margin-left: -60px;
                border: 16px solid #f3f3f3;
                border-top: 16px solid blue ;
                border-radius: 50%;
                border-top: 16px solid #3498db;
                width: 120px;
                height: 120px;
                animation: spin 2s linear infinite;
                z-index: 1;
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            .toggle-off.btn-lg {
                padding-left: 0px;
                padding-right: 0px;
                background-color: lightgrey;
            }
            .toggle-on.btn-lg {
                padding-left: 0px;
                padding-right: 0px;
            }
            .form-row {
                margin-left: 0;
                margin-right: 0;
            }
        </style>

    </head>
    
    <body>
        <!-- Loading Icon -->
        <div id="loading" class="loader" style="display: none;"></div>
        
        <!-- This is the where The actual website is being designed -->
        <div class="container-fluid">
            <div class="row" style="padding-left: 5%; padding-right: 5%; padding-top: 10%;">
                
                <!-- This is the far left column -->
                <div class="col-lg" style = "background-color: rgba(245, 245, 230, 0.85); border-radius: 20px;">
                    <!-- This is for the logo on the page. It will take the user back to the main page-->
                    <div class="row justify-content-center">
                        <div class="col-lg-2" style="padding-top: 1%;">
                            <img src=https://imgur.com/WWBP2zX.png alt="Travel Ahoy Logo" style="width: 85%; display: block; margin-left: auto; margin-right: auto;">
                        </div>
                        <div class="col-lg-3 align-self-center">
                            <h1>Travel Ahoy<h1>
                        </div> 
                    </div>
                    <br>
                    <!-- This is where all of the information will be collected from the user -->
                    <form id = dark style="border-radius: 10px;">
                        <div class="col-lg-12 justify-content-center" >
                            <div class="form-row justify-content-center" >
                                <!-- Input box for starting desination -->
                                <div class="col-lg-2">
                                    <div class="form-group mb-3" >
                                        <label for="WhereFrom">Where From:</label>
                                        <input type="text" id="WhereFrom" class="form-control" aria-label="Default"
                                            aria-describedby="inputGroup-sizing-default" title="The location you are traveling from.">
                                    </div>
                                </div>
                                <!-- Input box for ending destination -->
                                <div class="col-lg-2">
                                    <div class="form-group mb-3" >
                                        <label for="WhereTo"> Where To:</label>
                                        <input type="text" id="WhereTo" class="form-control" aria-label="Default"
                                            aria-describedby="inputGroup-sizing-default" title="The location you are traveling to.">
                                    </div>
                                </div>
                                <!-- Input box for Start Date-->
                                <div class="col-lg-2">
                                    <div class="form-group mb-3">
                                        <label for="StartDate">Start Date:</label>
                                        <input type="date" id = "StartDate" class="form-control" aria-label="Default"
                                            aria-describedby="inputGroup-sizing-default" title="The date you plan to leave. (Please use calander)">
                                    </div>
                                </div>
                                <!-- Input box for End Date-->
                                <div class="col-lg-2">
                                    <div class="form-group mb-3">
                                        <label for="EndDate">End Date:</label>
                                        <input type="date" id = "EndDate" class="form-control" aria-label="Default"
                                            aria-describedby="inputGroup-sizing-default" title="The date you plan to return. (Please use calander)">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
    
                        <!-- Second Row of Middle Column: Info of: Start Date, End Date, Max Traveler, Max Cost, and Currency -->
                        <div class="form-row justify-content-center">
                            <!-- Input box for number of travelers -->
                            <div class="col-lg-2">
                                <div class="from-group mb-3">
                                    <label for="NumTravelers">Number of Travelers</label>
                                    <input type="text" id= "NumTravelers"class="form-control" aria-label="Default"
                                        aria-describedby="inputGroup-sizing-default" title="The number of people in your group.">
                                </div>
                            </div>
                            <!-- Input box for currency selection -->
                            <div class="col-lg-1">
                                <div class="form-group mb-3">
                                    <label for="Currency"> Currency </label>
                                    <select class="custom-select" id="Currency" aria-label="Currency Select" title="Your preferred currency.">
                                        <option value="€">€</option>
                                        <option value="$" selected>$</option>
                                        <option value="£">£</option>
                                        <option value="¥">¥</option>
                                    </select>
                                </div>
                            </div>
                            <!-- Button for submitting data -->
                            <div class="col-lg-3 my-auto"> 
                                <button id = "submitButton" type="button" class="btn btn-primary btn-lg btn-block" onclick=test(this)>
                                    Submit
                                </button>
                            </div>
                        </div>

                        <!-- Third Row to allow Accessibility Option -->
                        <div class="form-row justify-content-center" >
                            <u><div id = "access-toggle" display > Accessibility Options</div></u>
                        </div>
                        <div id = "accessibility-tab" class="form-row justify-content-center" style="border-radius: 10px;">
                            <!-- Allowing Accessibility -->
                            <label id="access-option-1" style="padding-top: 0.5rem; padding-right: 5%;">
                                <input type="checkbox" data-toggle="toggle" data-on="Enabled" data-off="Disabled" data-size = "large" > Cognitive Disability Profile
                            </label>

                            <label id="access-option-2" style = "padding-left: 2%; padding-top: 0.5rem;">
                                <input type="checkbox" data-toggle="toggle" data-on="Enabled" data-off="Disabled" data-size = "large"> Dark Contrast Mode
                            </label>

                        </div>

                    </form>
                </div>
            </div>
        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        
        <script>
            var loadState = true; 
            var select = false;
            var accFontState = false;
            var DarkContrast = false;


            

            $(document).ready(function(){
                $("#accessibility-tab").hide();



                $("#submitButton").click(function(){        
                    if(loadState)   $("#loading").show();
                });

                $("#access-toggle").click(function(){
                    console.log(select);
                    if(!select){
                        $("#access-toggle").css("padding-bottom","20px");
                        if(DarkContrast) {
                            $("#accessibility-tab").css("background-color","transparent")
                        } else {
                            $("#accessibility-tab").css("background-color","rgba(128,128,128,1)")
                        }
                        select = true;
                    }
                    else{
                        $("#access-toggle").css("padding-bottom","0px");
                        select = false;
                    } 
                    $("#accessibility-tab").toggle(500);
                });
            });

            function changeText() {
                if(!accFontState) {
                    accFontState = true;
                    $("body").css("font-family", "Arial");
                    $("body").css("font-size", "130%");
                    $("input select button").addClass("border border-secondary");
                    
                }
                else {
                    accFontState = false;
                    $("body").css("font-family", "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,Liberation Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji");
                    $("body").css("font-size", "110%");
                    $("input select button").removeClass("border border-secondary");
                }
            }

            function contrastMode() {
                if(!DarkContrast) {
                    DarkContrast = true;
                    $("#dark").not(".toggle-off").css("background-color", "black");
                    $("#dark, #dark .btn").not(".toggle-off").css("color", "white");
                    $("#dark").css("font-weight", "bold");
                    $("#accessibility-tab").css("background-color","black")
                    $("#dark").css("border-radius: 20px");
                }
                else {
                    DarkContrast = false;
                    $("#dark").css("background-color", "transparent");
                    $("#dark, #dark .btn").css("color", "");
                    $("#dark .btn").css("background-color", "");
                    $("#dark").css("font-weight", "normal");
                    $("#accessibility-tab").css("background-color","rgba(128,128,128,1)")
                    $("#dark").css("border-radius: 0px");
                }
            }

            $("#access-option-1").click(changeText);
            $("#access-option-2").click(contrastMode);

            var autocomplete;
            var autocomplete2;
            var input;
            var input2;
            function activatePlacesSearch(){
                input = document.getElementById('WhereFrom');
                autocomplete = new google.maps.places.Autocomplete(input);
                input2 = document.getElementById('WhereTo');
                autocomplete2 = new google.maps.places.Autocomplete(input2);
            }


            function test(btn) {
                // var val = btn.form.querySelector('input[name="WhereFrom"]').value;
                // alert(val);

                if((typeof(autocomplete.getPlace()) == "undefined")
                || (typeof(autocomplete2.getPlace()) == "undefined")
                || startDate == ""
                || numTravelers == ""
                || currency == ""
                ) {
                    loadState = false;
                    $("#loading").hide();
                    alert("You are missing a field!");
                    return
                }else loadState = true;


                var startAddress = autocomplete.getPlace().formatted_address;
                var endAddress = autocomplete2.getPlace().formatted_address;
                var startDate = document.getElementById("StartDate").value;
                var endDate = document.getElementById("EndDate").value;
                var numTravelers = document.getElementById("NumTravelers").value;
                var currency = document.getElementById("Currency").value;
            //     

                console.log(autocomplete);
                //console.log(autocomplete.gm_accessors_.place.Ve.place.geometry.location.lng());


                var startLat = autocomplete.getPlace().geometry.location.lat();
                var startLng = autocomplete.getPlace().geometry.location.lng();
                var endLat = autocomplete2.getPlace().geometry.location.lat();
                var endLng = autocomplete2.getPlace().geometry.location.lng();

                var startCity = autocomplete.getPlace().name;
                var endCity = autocomplete2.getPlace().name;

                var startAddrComponents = autocomplete.getPlace().address_components;
                var startCountry;
                var startCountryName;

                for(var i=0; i<startAddrComponents.length; i++) {
                    if (startAddrComponents[i].types.includes("country")) {
                        startCountry = startAddrComponents[i].short_name;
                        startCountryName = startAddrComponents[i].long_name;
                    }
                }

                var endAddrComponents = autocomplete2.getPlace().address_components;
                var endCountry;
                var endCountryName;

                for(var i=0; i<endAddrComponents.length; i++) {
                    if (endAddrComponents[i].types.includes("country")) {
                        endCountry = endAddrComponents[i].short_name;
                        endCountryName = endAddrComponents[i].long_name;
                    }
                }
                
                var fontState = "false"
                var darkContrastState = "false"
                if(accFontState) fontState = "true";
                if(DarkContrast) darkContrastState = "true";

                var newURL = "/main";
                newURL += `?originCity=${startCity}`
                newURL += `&originLat=${startLat}`
                newURL += `&originLng=${startLng}`
                newURL += `&originCountry=${startCountry}`
                newURL += `&destCity=${endCity}`
                newURL += `&destLat=${endLat}`
                newURL += `&destLng=${endLng}`
                newURL += `&destCountry=${endCountry}`
                newURL += `&currency=${currency}`
                newURL += `&numTravelers=${numTravelers}`
                newURL += `&startDate=${startDate}`
                newURL += `&startAddress=${startAddress}`
                newURL += `&endAddress=${endAddress}`
                newURL += `&fontState=${fontState}`
                newURL += `&darkContrastState=${darkContrastState}`
                newURL += `&startCountryName=${startCountryName}`
                newURL += `&endCountryName=${endCountryName}`
                
                if(endDate == "") {
                    if(confirm('You have not filled in "End Date" field. Round trip flights will not be included. Would you like to continue?')) {
                        $("#loading").show();

                        

                    } else {
                        console.log('User did not continue.');
                        return;
                    }
                    
                }
                else {
                    newURL += `&endDate=${endDate}`
                }
                window.location = origin + newURL;

                $("#loading").hide();
            }

            
            
        </script>

        <script async
        src="https://maps.googleapis.com/maps/api/js?key=REDACTED&libraries=places&callback=activatePlacesSearch&types=(cities)">
        </script>
    </body>
</html>

